<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atauni İntörn Nöbet Fiyatı Takibi</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
</head>
<body>
    <h1>Ata Uni İntörn Nöbet Fiyatı Takibi</h1>
    
    <h2>Son Satılan Nöbetler</h2>
    <div id="stocks"></div>
    <button id="load-more" style="display:none;">Daha Eski</button>

    <h2>Averaj Fiyatlar</h2>
    <div id="average-prices">
        <p>24 Saatlik Nöbetlerin Ortalama Fiyat: <span id="average-24-saat">0</span> TL</p>
        <p>Diğer Nöbetlerin Ortalama Fiyatı: <span id="average-other">0</span> TL</p>
        <div id="individual-averages"></div>
    </div>

    <h2>Nöbet Satışı Ekle</h2>
    <select id="stock-select">
        <option value="Acil">Acil</option>
        <option value="Acil 24 Saat">Acil 24 Saat</option>
        <option value="Pediatri">Pediatri</option>
        <option value="Pediatri 24 Saat">Pediatri 24 Saat</option>
        <option value="Genel Cerrahi">Genel Cerrahi</option>
        <option value="Genel Cerrahi 24 Saat">Genel Cerrahi 24 Saat</option>
        <option value="Dahiliye">Dahiliye</option>
        <option value="Dahiliye 24 Saat">Dahiliye 24 Saat</option>
        <option value="Kadın Doğum">Kadın Doğum</option>
        <option value="Kadın Doğum 24 Saat">Kadın Doğum 24 Saat</option>
        <option value="Seçmeli">Seçmeli</option>
        <option value="Seçmeli 24 Saat">Seçmeli 24 Saat</option>
    </select>
    <input type="date" id="date" />
    <input type="number" id="price" placeholder="Fiyat" />
    <button onclick="addStock()">Ekle</button>

    <h2>Veri Sıfırlama</h2>
    <input type="password" id="reset-password" placeholder="Şifre" />
    <button onclick="resetData()">Veri Sıfırla</button>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC035yNDCY-LKV_NHXxdDaJBcPM_HY_zW4",
            authDomain: "nobettakip-447bf.firebaseapp.com",
            databaseURL: "https://nobettakip-447bf-default-rtdb.firebaseio.com",
            projectId: "nobettakip-447bf",
            storageBucket: "nobettakip-447bf.appspot.com",
            messagingSenderId: "685407754980",
            appId: "1:685407754980:web:5e63808d0c36186afbaaf1",
            measurementId: "G-N36D0ST83P"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const stocksRef = database.ref('stocks');
        let stocksArray = [];
        let currentDisplayCount = 5;

        function addStock() {
            const stock = document.getElementById('stock-select').value;
            const date = document.getElementById('date').value;
            const price = document.getElementById('price').value;

            if (stock && date && price) {
                stocksRef.push({ stock, date, price });
                document.getElementById('date').value = '';
                document.getElementById('price').value = '';
            } else {
                alert('Lütfen tüm alanları doldurun.');
            }
        }

        function resetData() {
            const password = document.getElementById('reset-password').value;
            if (password === '79066540') {
                stocksRef.set({});
            } else {
                alert('Yanlış şifre!');
            }
        }

        function updateAveragePrices(snapshot) {
            let total24Saat = 0;
            let count24Saat = 0;
            let totalOther = 0;
            let countOther = 0;

            const stockTotals = {};
            const stockCounts = {};

            snapshot.forEach(childSnapshot => {
                const data = childSnapshot.val();
                const price = parseFloat(data.price);
                if (data.stock.includes("24 Saat")) {
                    total24Saat += price;
                    count24Saat++;
                } else {
                    totalOther += price;
                    countOther++;
                }

                if (!stockTotals[data.stock]) {
                    stockTotals[data.stock] = 0;
                    stockCounts[data.stock] = 0;
                }
                stockTotals[data.stock] += price;
                stockCounts[data.stock]++;
            });

            const average24Saat = count24Saat ? (total24Saat / count24Saat).toFixed(2) : 0;
            const averageOther = countOther ? (totalOther / countOther).toFixed(2) : 0;

            document.getElementById('average-24-saat').innerText = average24Saat;
            document.getElementById('average-other').innerText = averageOther;

            const individualAveragesDiv = document.getElementById('individual-averages');
            individualAveragesDiv.innerHTML = '';
            for (const stock in stockTotals) {
                const average = (stockCounts[stock] ? (stockTotals[stock] / stockCounts[stock]).toFixed(2) : 0);
                individualAveragesDiv.innerHTML += `<p>${stock}: ${average} TL</p>`;
            }
        }

        function renderStocks() {
            const stocksDiv = document.getElementById('stocks');
            stocksDiv.innerHTML = '';
            const end = Math.min(currentDisplayCount, stocksArray.length);
            for (let i = 0; i < end; i++) {
                const data = stocksArray[i];
                stocksDiv.innerHTML += `<p>${data.date} - ${data.stock}: ${data.price} TL</p>`;
            }
            document.getElementById('load-more').style.display = currentDisplayCount < stocksArray.length ? 'block' : 'none';
        }

        document.getElementById('load-more').onclick = () => {
            currentDisplayCount += 5;
            renderStocks();
        };

        stocksRef.on('value', (snapshot) => {
            stocksArray = [];
            snapshot.forEach(childSnapshot => {
                stocksArray.push(childSnapshot.val());
            });
            renderStocks();
            updateAveragePrices(snapshot);
        });
    </script>
</body>
</html>





